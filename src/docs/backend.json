{
  "entities": {
    "UserProfile": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "UserProfile",
      "type": "object",
      "description": "Represents a user profile in the HyipNexus application.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the UserProfile entity, matching the Firebase Auth UID."
        },
        "username": {
          "type": "string",
          "description": "The username of the user."
        },
        "email": {
          "type": "string",
          "description": "The email address of the user.",
          "format": "email"
        },
        "registrationDate": {
          "type": "string",
          "description": "The date and time when the user registered.",
          "format": "date-time"
        },
        "referrerId": {
          "type": "string",
          "description": "The UID of the user who referred this user."
        },
        "balance": {
          "type": "number",
          "description": "The user's current account balance."
        },
        "lastProfitClaim": {
          "type": "string",
          "description": "The timestamp of the last daily profit claim.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "username",
        "email",
        "registrationDate"
      ]
    },
    "InvestmentPlan": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "InvestmentPlan",
      "type": "object",
      "description": "Represents an investment plan offered in the HyipNexus application.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the InvestmentPlan entity."
        },
        "name": {
          "type": "string",
          "description": "The name of the investment plan."
        },
        "description": {
          "type": "string",
          "description": "A detailed description of the investment plan."
        },
        "minimumInvestment": {
          "type": "number",
          "description": "The minimum amount required to invest in this plan."
        },
        "maximumInvestment": {
          "type": "number",
          "description": "The maximum amount allowed to invest in this plan."
        },
        "returnPercentage": {
          "type": "number",
          "description": "The percentage of return offered by this plan."
        },
        "durationDays": {
          "type": "number",
          "description": "The duration of the investment plan in days."
        }
      },
      "required": [
        "id",
        "name",
        "description",
        "minimumInvestment",
        "returnPercentage",
        "durationDays"
      ]
    },
    "Investment": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Investment",
      "type": "object",
      "description": "Represents a user's investment in a specific investment plan.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Investment entity."
        },
        "userProfileId": {
          "type": "string",
          "description": "Reference to the UserProfile who made this investment. (Relationship: UserProfile 1:N Investment)"
        },
        "investmentPlanId": {
          "type": "string",
          "description": "Reference to the InvestmentPlan in which the user invested. (Relationship: InvestmentPlan 1:N Investment)"
        },
        "amount": {
          "type": "number",
          "description": "The amount invested by the user."
        },
        "startDate": {
          "type": "string",
          "description": "The date when the investment started.",
          "format": "date-time"
        },
        "endDate": {
          "type": "string",
          "description": "The date when the investment is expected to end.",
          "format": "date-time"
        },
        "status": {
          "type": "string",
          "description": "The current status of the investment (e.g., active, completed, cancelled)."
        }
      },
      "required": [
        "id",
        "userProfileId",
        "investmentPlanId",
        "amount",
        "startDate",
        "endDate",
        "status"
      ]
    },
    "Transaction": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Transaction",
      "type": "object",
      "description": "Represents a financial transaction related to a user's investment.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Transaction entity."
        },
        "userProfileId": {
          "type": "string",
          "description": "Reference to the UserProfile associated with this transaction. (Relationship: UserProfile 1:N Transaction)"
        },
        "investmentId": {
          "type": "string",
          "description": "Reference to the Investment associated with this transaction. (Relationship: Investment 1:N Transaction)"
        },
        "type": {
          "type": "string",
          "description": "The type of transaction (e.g., deposit, withdrawal, interest payment)."
        },
        "amount": {
          "type": "number",
          "description": "The amount of the transaction."
        },
        "transactionDate": {
          "type": "string",
          "description": "The date and time when the transaction occurred.",
          "format": "date-time"
        },
        "paymentGateway": {
          "type": "string",
          "description": "The Payment Gateway used for transaction."
        },
        "status": {
          "type": "string",
          "description": "The status of the transaction (e.g., Completed, Pending, Failed)."
        },
        "withdrawAddress": {
          "type": "string",
          "description": "Wallet address for a withdrawal request."
        },
        "depositProof": {
          "type": "string",
          "description": "Data URI of the uploaded deposit proof image."
        }
      },
      "required": [
        "id",
        "userProfileId",
        "type",
        "amount",
        "transactionDate",
        "status"
      ]
    },
    "Referral": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Referral",
      "type": "object",
      "description": "Represents a referral relationship between two users.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Referral entity."
        },
        "referrerId": {
          "type": "string",
          "description": "Reference to the UserProfile who made the referral. (Relationship: UserProfile 1:N Referral (Self-Referential))"
        },
        "referredId": {
          "type": "string",
          "description": "Reference to the UserProfile who was referred. (Relationship: UserProfile 1:N Referral (Self-Referential))"
        },
        "referralDate": {
          "type": "string",
          "description": "The date when the referral was made.",
          "format": "date-time"
        },
        "bonusAmount": {
          "type": "number",
          "description": "The bonus ammount awarded to the referrer."
        }
      },
      "required": [
        "id",
        "referrerId",
        "referredId",
        "referralDate",
        "bonusAmount"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/users/{userId}",
        "definition": {
          "entityName": "UserProfile",
          "schema": {
            "$ref": "#/backend/entities/UserProfile"
          },
          "description": "Stores user profile information. The document ID 'userId' corresponds to the Firebase Auth UID, ensuring a direct 1-to-1 link between authentication and user data.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user, matching the Firebase Auth UID."
            }
          ]
        }
      },
      {
        "path": "/investment_plans/{investmentPlanId}",
        "definition": {
          "entityName": "InvestmentPlan",
          "schema": {
            "$ref": "#/backend/entities/InvestmentPlan"
          },
          "description": "Stores details of available investment plans.",
          "params": [
            {
              "name": "investmentPlanId",
              "description": "The unique identifier for the investment plan."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/investments/{investmentId}",
        "definition": {
          "entityName": "Investment",
          "schema": {
            "$ref": "#/backend/entities/Investment"
          },
          "description": "Stores user's investment details, nested under their profile for ownership. The 'userProfileId' field inside the Investment document must match the 'userId' path parameter.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user, matching the Firebase Auth UID."
            },
            {
              "name": "investmentId",
              "description": "The unique identifier for the investment."
            }
          ]
        }
      },
      {
        "path": "/transactions/{transactionId}",
        "definition": {
          "entityName": "Transaction",
          "schema": {
            "$ref": "#/backend/entities/Transaction"
          },
          "description": "Stores user's transaction history, nested under their profile for ownership. The 'userProfileId' field inside the Transaction document must match the 'userId' path parameter.",
          "params": [
            {
              "name": "transactionId",
              "description": "The unique identifier for the transaction."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/referrals/{referralId}",
        "definition": {
          "entityName": "Referral",
          "schema": {
            "$ref": "#/backend/entities/Referral"
          },
          "description": "Stores user's referral details, nested under their profile for ownership.  The 'referrerId' field inside the Referral document must match the 'userId' path parameter.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user, matching the Firebase Auth UID."
            },
            {
              "name": "referralId",
              "description": "The unique identifier for the referral."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore data structure is designed to ensure security, scalability, and ease of debugging, particularly focusing on Authorization Independence. User profiles are stored in a top-level `users` collection where the document ID is the user's Auth UID. This provides a clear, 1-to-1 mapping. Investment plans and announcements are stored globally, while user-specific investments, transactions, and referrals are nested under the user's document. This structure allows for clear and enforceable security rules. Specifically, Authorization Independence is achieved by avoiding hierarchical authorization dependencies; user-related data (investments, transactions, referrals) are stored under the `/users/{userId}` path. This allows for direct access to user data without needing to `get()` data from parent documents. QAPs (Rules are not Filters) are supported by structuring data to enable secure list operations. Public data is segregated from user data, ensuring list operations on public collections do not expose user-sensitive information."
  }
}
